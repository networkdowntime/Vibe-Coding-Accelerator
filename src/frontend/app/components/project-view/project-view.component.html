<div class="project-view-container">
  <header class="bg-white shadow rounded-xl mb-6 p-6">
    <div class="!flex !justify-between !items-center !w-full mb-4" style="display: flex !important; justify-content: space-between !important;">
      <nav class="breadcrumb-nav">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a routerLink="/" class="text-blue-600 hover:text-blue-800">Projects</a>
          </li>
          <li class="breadcrumb-separator">/</li>
          <li class="breadcrumb-item active">{{ project?.displayName || projectId || 'Unknown Project' }}</li>
        </ol>
      </nav>
      <a [routerLink]="['/settings']" [queryParams]="{ returnUrl: '/project/' + projectId }" class="settings-icon" title="Settings">
        <i class="fas fa-cog"></i>
      </a>
    </div>
    <div class="project-title-section">
      <div class="project-title-with-actions">
        <h1 class="text-xl font-semibold text-gray-800">Project: {{ project?.displayName || projectId || 'Unknown' }}</h1>
        <div class="project-actions">
          <button 
            class="icon-btn edit-btn" 
            (click)="editProjectName()" 
            title="Edit project name"
            type="button">
            <i class="fas fa-edit"></i>
          </button>
          <button 
            class="icon-btn delete-btn" 
            (click)="deleteProject()" 
            title="Delete project"
            type="button">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Error Message Display -->
  <div *ngIf="errorMessage" class="error-banner">
    <span class="error-icon">❌</span>
    {{ errorMessage }}
    <button class="close-error" (click)="errorMessage = ''" type="button">×</button>
  </div>
  
  <main class="content">
    <div class="project-details">
      
      <!-- AI Agent Configuration Section -->
      <section class="agent-config-section">
        <div class="section-header">
          <h2>AI Agent Configuration</h2>
          <div class="config-actions">
            <!-- Generate Config Button -->
            <button 
              *ngIf="!processingState.isProcessing"
              [disabled]="!canGenerateConfig"
              (click)="generateConfig()"
              class="btn btn-primary generate-config-btn"
              [class.disabled]="!canGenerateConfig"
              title="{{ canGenerateConfig ? 'Generate AI agent configuration files' : 'Select an AI agent and at least one tech stack to enable' }}"
              type="button">
              <i class="fas fa-magic"></i>
              Generate AI Agent Config
            </button>
            
            <!-- Processing Controls -->
            <div *ngIf="processingState.isProcessing" class="processing-controls">
              <button 
                (click)="cancelConfigGeneration()"
                class="btn btn-secondary cancel-btn"
                type="button">
                <i class="fas fa-stop"></i>
                Cancel
              </button>
            </div>
            
            <!-- Retry Button for Failed Jobs -->
            <button 
              *ngIf="processingState.currentJob?.status === 'failed'"
              (click)="retryConfigGeneration()"
              class="btn btn-warning retry-btn"
              type="button">
              <i class="fas fa-redo"></i>
              Retry
            </button>
            
            <!-- Download AI Agent Config Button -->
            <button 
              *ngIf="processingState.currentJob?.status === 'completed'"
              (click)="downloadResults()"
              class="btn btn-success download-btn"
              type="button"
              title="Download AI agent configuration zip file">
              <i class="fas fa-download"></i>
              Download AI Config
            </button>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div *ngIf="processingState.isProcessing || processingState.currentJob" class="progress-section">
          <div class="progress-info">
            <span class="progress-status">
              {{ processingState.currentJob?.status === 'pending' ? 'Preparing...' : 
                 processingState.currentJob?.status === 'processing' ? 'Processing files...' :
                 processingState.currentJob?.status === 'completed' ? 'Completed successfully!' :
                 processingState.currentJob?.status === 'failed' ? 'Processing failed' :
                 processingState.currentJob?.status === 'cancelled' ? 'Processing cancelled' : 'Unknown status' }}
            </span>
            <span *ngIf="processingState.currentJob?.progress" class="progress-details">
              Processing files...
            </span>
          </div>
          
          <div class="progress-bar-container">
            <div class="progress-bar" 
                 [style.width.%]="processingState.currentJob?.progress?.percentage || 0"
                 [class.success]="processingState.currentJob?.status === 'completed'"
                 [class.error]="processingState.currentJob?.status === 'failed'"
                 [class.warning]="processingState.currentJob?.status === 'cancelled'">
            </div>
          </div>
          
          <div *ngIf="processingState.currentJob?.progress?.current" class="current-file">
            Currently processing: <code>{{ processingState.currentJob?.progress?.current }}</code>
          </div>
        </div>
        
        <app-agent-select 
          [projectName]="projectId || ''"
          (agentChanged)="onAgentChanged($event)"
          (techStackChanged)="onTechStackChanged($event)"
          (error)="onAgentError($event)">
        </app-agent-select>
      </section>
      
      <!-- File Management Section -->
      <section class="file-management-section">
        <app-file-list 
          [projectName]="projectId || ''"
          (fileUploaded)="onFileUploaded()"
          (fileUpdated)="onFileUpdated()"
          (error)="onFileError($event)">
        </app-file-list>
      </section>
    </div>
  </main>
</div>

<!-- Modal -->
<app-project-modal 
  *ngIf="showModal" 
  [data]="modalData"
  (result)="onModalResult($event)"
></app-project-modal>
